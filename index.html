<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Save Log</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
    <div class="container mt-5" style="max-width: 480px;">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white text-center">
                <h5 class="mb-0">Save Log</h5>
            </div>
            <div class="card-body">
                <form id="userForm">
                    <div class="mb-3">
                        <label for="employeeSelect" class="form-label">Select Employee</label>
                        <select id="employeeSelect" class="form-select" required>
                            <option value="" disabled selected>Select an employee</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" id="address" class="form-control" required />
                    </div>
                    <button type="submit" class="btn btn-success w-100">Submit</button>
                </form>
                <div id="status" class="mt-3"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>

    <script>
        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCuYcSe-tymWi2nENVq-fBgOzr2TBA4enc",
            authDomain: "live-location-2d40d.firebaseapp.com",
            projectId: "live-location-2d40d",
            databaseURL: "https://live-location-2d40d-default-rtdb.firebaseio.com",
            storageBucket: "live-location-2d40d.appspot.com",
            messagingSenderId: "923437376784",
            appId: "1:923437376784:web:f542d800e1536cdeccb195",
            measurementId: "G-80P6JMPTBD"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        // Load employee names into dropdown
        const employeeSelect = document.getElementById('employeeSelect');

        firebase.firestore().collection("employee").orderBy("name").get()
            .then(snapshot => {
                snapshot.forEach(doc => {
                    const employee = doc.data();
                    const option = document.createElement("option");
                    option.value = employee.name;
                    option.textContent = employee.name;
                    employeeSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error loading employee list:", error);
                const opt = document.createElement("option");
                opt.value = "";
                opt.textContent = "Error loading employees";
                employeeSelect.appendChild(opt);
            });

        document.getElementById('userForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const status = document.getElementById('status');
            status.innerHTML = '<div class="alert alert-info">Fetching location...</div>';

            if (!navigator.geolocation) {
                status.innerHTML = '<div class="alert alert-danger">Geolocation not supported.</div>';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    const name = document.getElementById('employeeSelect').value;
                    const address = document.getElementById('address').value;
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;

                    db.collection("users").add({
                        name,
                        address,
                        location: {
                            lat,
                            lng
                        },
                        createdAt: new Date()
                    }).then(() => {
                        status.innerHTML = '<div class="alert alert-success">Data saved to Firebase!</div>';
                        document.getElementById('userForm').reset();
                    }).catch((error) => {
                        status.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                    });
                },
                function () {
                    status.innerHTML = '<div class="alert alert-warning">Unable to retrieve location.</div>';
                }
            );
        });
    </script>
</body>

</html>